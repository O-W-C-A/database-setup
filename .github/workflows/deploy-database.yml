name: Deploy SQL Schema
on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Set Environment Variables
      env:
        AZURE_SQL_SERVER: ${{ secrets.AZURE_SQL_SERVER }}
        AZURE_SQL_DB_NAME: ${{ secrets.AZURE_SQL_DB_NAME }}
        AZURE_SQL_USER: ${{ secrets.AZURE_SQL_USER }}
        AZURE_SQL_PASSWORD: ${{ secrets.AZURE_SQL_PASSWORD }}
      run: |
        echo "Environment variables set."

    - name: Deploy Schema using SQLPackage
      run: |
        sqlpackage /Action:Publish \
                   /SourceFile:ExamsDB.dacpac \
                   /TargetServerName:$AZURE_SQL_SERVER \
                   /TargetDatabaseName:$AZURE_SQL_DB_NAME \
                   /TargetUser:$AZURE_SQL_USER \
                   /TargetPassword:$AZURE_SQL_PASSWORD
